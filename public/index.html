<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Forum Feed</title>

  <link rel="stylesheet" href="styles/style.css">
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ✅ Plyr -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.css" />
  <script src="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.polyfilled.min.js"></script>
  <script
    src="https://unpkg.com/filepond-plugin-file-validate-type/dist/filepond-plugin-file-validate-type.js"></script>
  <script src="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.js"></script>
  <script src="https://unpkg.com/filepond-plugin-media-preview/dist/filepond-plugin-media-preview.js"></script>
  <script src="https://unpkg.com/filepond-plugin-file-poster/dist/filepond-plugin-file-poster.js"></script>
  <script src="https://unpkg.com/filepond/dist/filepond.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tributejs@5.1.3/dist/tribute.css">
  <link href="https://unpkg.com/filepond/dist/filepond.css" rel="stylesheet" />
  <link href="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.css"
    rel="stylesheet" />
  <link href="https://unpkg.com/filepond-plugin-media-preview/dist/filepond-plugin-media-preview.css"
    rel="stylesheet" />
  <link href="https://unpkg.com/filepond-plugin-file-poster/dist/filepond-plugin-file-poster.css" rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsrender/jsrender.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tributejs@5.1.3/dist/tribute.min.js"></script>

</head>

<body class="max-w-[700px] bg-[#f1f1f1] flex flex-col items-center justify-center m-auto p-6 max-[768px]:p-2">
  <div id="topOfForum"></div>
  <div onclick="document.getElementById('topOfForum').scrollIntoView({ behavior: 'smooth' })"
    class="p-3 bg-[var(--primary)] flex items-center justify-center cursor-pointer fixed bottom-[1rem] right-[1rem] max-[768px]:hidden z-[99]">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M20.4228 10.9233C20.3455 11.0008 20.2535 11.0622 20.1524 11.1042C20.0512 11.1461 19.9428 11.1677 19.8333 11.1677C19.7238 11.1677 19.6153 11.1461 19.5142 11.1042C19.413 11.0622 19.3211 11.0008 19.2437 10.9233L13.1668 4.84535V21.1667C13.1668 21.3877 13.079 21.5997 12.9228 21.7559C12.7665 21.9122 12.5545 22 12.3335 22C12.1125 22 11.9006 21.9122 11.7443 21.7559C11.588 21.5997 11.5002 21.3877 11.5002 21.1667V4.84535L5.42333 10.9233C5.26697 11.0796 5.0549 11.1675 4.83377 11.1675C4.61264 11.1675 4.40057 11.0796 4.24421 10.9233C4.08784 10.7669 4 10.5548 4 10.3337C4 10.1126 4.08784 9.90051 4.24421 9.74415L11.744 2.2444C11.8214 2.16692 11.9133 2.10546 12.0144 2.06352C12.1156 2.02158 12.224 2 12.3335 2C12.443 2 12.5515 2.02158 12.6526 2.06352C12.7538 2.10546 12.8457 2.16692 12.9231 2.2444L20.4228 9.74415C20.5003 9.82154 20.5618 9.91345 20.6037 10.0146C20.6457 10.1158 20.6672 10.2242 20.6672 10.3337C20.6672 10.4432 20.6457 10.5517 20.6037 10.6528C20.5618 10.754 20.5003 10.8459 20.4228 10.9233Z"
        fill="white"></path>
    </svg>
  </div>

  <div class="hidden px-4 py-6 bg-[#d1d1d1] w-full mb-4 relative">
    <div class="bell-wrapper relative ml-auto w-max">
      <div class="bell text-sm cursor-pointer notificationWrapperToggler">🔔</div>
    </div>
    <div
      class="notificationsWrapper hidden flex-col p-4 absolute top-[4rem] right-0 bg-white shadow-lg rounder w-full max-w-[400px] h-[400px] overflow-y-scroll z-[9]">
      <div class="text-sm">Notifications</div>
      <div class="text-xs text-blue-600 cursor-pointer hover:underline" id="markAllAsRead">
        Mark all as read
      </div>
      <div id="output" class="mt-4"></div>
    </div>
  </div>

  <div id="create-post-trigger" class="bg-white shadow-lg rounded w-full p-4 flex items-center cursor-pointer mb-4">
    <span class="text-gray-500">What's on your mind?</span>
    <img
      src="https://files.ontraport.com/media/b0456fe87439430680b173369cc54cea.php03bzcx?Expires=4895186056&Signature=fw-mkSjms67rj5eIsiDF9QfHb4EAe29jfz~yn3XT0--8jLdK4OGkxWBZR9YHSh26ZAp5EHj~6g5CUUncgjztHHKU9c9ymvZYfSbPO9JGht~ZJnr2Gwmp6vsvIpYvE1pEywTeoigeyClFm1dHrS7VakQk9uYac4Sw0suU4MpRGYQPFB6w3HUw-eO5TvaOLabtuSlgdyGRie6Ve0R7kzU76uXDvlhhWGMZ7alNCTdS7txSgUOT8oL9pJP832UsasK4~M~Na0ku1oY-8a7GcvvVv6j7yE0V0COB9OP0FbC8z7eSdZ8r7avFK~f9Wl0SEfS6MkPQR2YwWjr55bbJJhZnZA__&Key-Pair-Id=APKAJVAAMVW6XQYWSTNA"
      alt="avatar" class="w-8 h-8 rounded-full ml-auto">
  </div>

  <div id="create-post-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
    <div class="bg-white p-4 rounded shadow-lg w-[90%] max-w-lg relative">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-bold">Create a Post</h2>
        <button id="close-post-modal">✕</button>
      </div>
      <div id="post-creation-form" class="post-form">
        <div class="toolbar">
          <button data-cmd="bold"><b>B</b></button>
          <button data-cmd="italic"><i>I</i></button>
          <button data-cmd="underline"><u>U</u></button>
          <button data-cmd="link">🔗</button>
        </div>
        <div id="post-editor" class="editor min-h-[80px] resize-y p-2 rounded" contenteditable="true"
          data-placeholder="Write a post..."></div>
        <div class="upload-section">
          <div class="flex item-center gap-4 my-4">
            <div class="emoji-wrapper relative">
              <button type="button" class="emoji-toggle">😊</button>
              <div class="emoji-picker hidden absolute bg-white border rounded shadow-md p-1 mt-1 z-10">
                <span class="cursor-pointer px-1">😀</span>
                <span class="cursor-pointer px-1">😂</span>
                <span class="cursor-pointer px-1">😍</span>
                <span class="cursor-pointer px-1">😎</span>
                <span class="cursor-pointer px-1">🤔</span>
                <span class="cursor-pointer px-1">😢</span>
                <span class="cursor-pointer px-1">👍</span>
                <span class="cursor-pointer px-1">🎉</span>
                <span class="cursor-pointer px-1">🚀</span>
                <span class="cursor-pointer px-1">🥳</span>
              </div>
            </div>
            <button id="recordBtn" class="recordBtn">🎙 Start Recording</button>
          </div>
          <input type="file" id="file-input" class="file-input" style="display: none;"
            accept="image/*,audio/*,video/*,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" />
          <canvas class="canvasWaveform waveform w-full" id="waveform" width="450" height="100"></canvas>
        </div>
      </div>
      <button class="ml-auto block" id="submit-post">Post</button>
    </div>
  </div>

  <div id="post-filters" class="bg-white post-filters w-full shadow-lg p-4 flex items-center flex-col my-4 rounded">
    <div
      class="flex items-center justify-between w-full max-[500px]:flex-col max-[500px]:items-start max-[500px]:gap-4">
      <div class="flex items-center gap-4 ">
        <button class="filter-btn active" data-filter="Recent">🕒</button>
        <button class="filter-btn" data-filter="Featured">⭐</button>
        <button class="filter-btn" data-filter="My Posts">👤</button>
        <button class="filter-btn" data-filter="Saved Posts">🔖</button>
      </div>

      <div class="flex items-center gap-4">

        <div class="sort-filter relative">
          <button id="sort-filter-btn" class="filter-btn">Latest ▾</button>
          <ul id="sort-filter-menu"
            class="sort-filter-menu absolute top-[100%] right-0 bg-[#ffffff] border border-1-[#ccc] list-style-none p-0 mr-[4px] w-fit z-[10]">
            <li class="py-2 px-8 cursor-pointer active" data-sort="Latest">Latest</li>
            <li class="py-2 px-8 cursor-pointer" data-sort="Oldest">Oldest</li>
            <li class="py-2 px-8 cursor-pointer text-nowrap" data-sort="Most Popular">Most Popular</li>
          </ul>
        </div>
        <div class="file-filter relative">
          <button id="file-filter-btn" class="filter-btn">All ▾</button>
          <ul id="file-filter-menu"
            class="file-filter-menu absolute top-[100%] right-0 bg-[#ffffff] border border-1-[#ccc] list-style-none p-0 mr-[4px] min-w-[6em] z-[10]">
            <li class="py-2 px-8 cursor-pointer" data-type="All" class="active">All</li>
            <li class="py-2 px-8 cursor-pointer" data-type="Image">Image</li>
            <li class="py-2 px-8 cursor-pointer" data-type="Video">Video</li>
            <li class="py-2 px-8 cursor-pointer" data-type="Audio">Audio</li>
            <li class="py-2 px-8 cursor-pointer" data-type="File">File</li>
          </ul>
        </div>
      </div>
    </div>
    <div class="search-wrapper w-full my-4 relative">
      <input type="text" id="searchPost" class="py-2 px-4 rounded text-sm" placeholder="Search by author or text…"
        autocomplete="off" />
      <span class="clearIcon hidden absolute top-[50%] right-[8px] cursor-pointer text-sm translate-y-[-50%]">✕</span>
      <span class="searchIcon absolute top-[50%] right-[8px] cursor-pointer text-sm translate-y-[-50%]">🔍</span>
    </div>
  </div>

  <div id="skeleton-loader" class="w-full">
    <div class="skeleton-item flex gap-4 p-4 mb-4 bg-white rounded shadow">
      <div class="skeleton-avatar"></div>
      <div class="flex-1 flex flex-col gap-2">
        <div class="skeleton-line short"></div>
        <div class="skeleton-line"></div>
        <div class="skeleton-line medium"></div>
      </div>
    </div>
    <div class="skeleton-item flex gap-4 p-4 mb-4 bg-white rounded shadow">
      <div class="skeleton-avatar"></div>
      <div class="flex-1 flex flex-col gap-2">
        <div class="skeleton-line short"></div>
        <div class="skeleton-line"></div>
        <div class="skeleton-line medium"></div>
      </div>
    </div>
    <div class="skeleton-item flex gap-4 p-4 mb-4 bg-white rounded shadow">
      <div class="skeleton-avatar"></div>
      <div class="flex-1 flex flex-col gap-2">
        <div class="skeleton-line short"></div>
        <div class="skeleton-line"></div>
        <div class="skeleton-line medium"></div>
      </div>
    </div>
  </div>

  <div id="forum-root" class="w-full"></div>

  <!-- Delete confirmation modal -->
  <div id="delete-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
    <div class="bg-white p-4 rounded shadow-lg w-[90%] max-w-sm">
      <h2 id="delete-modal-title" class="text-lg font-bold mb-4"></h2>
      <div class="flex justify-end gap-2">
        <button id="delete-confirm" class="bg-red-500 text-white px-4 py-1 rounded">Delete</button>
        <button id="delete-cancel" class="bg-gray-300 px-4 py-1 rounded">Cancel</button>
      </div>
    </div>
  </div>

  <script id="tmpl-item" type="text/x-jsrender">
      <div 
        class="item rounded bg-white shadow-xl flex flex-col gap-2 my-4 p-4 relative border-2 border-[#e9ebee]" 
        data-uid="{{:uid}}" 
        data-depth="{{:depth}}">
        {{if canDelete}}
          <button class="btn-delete" data-uid="{{:uid}}">🗑</button>
        {{/if}}
        <div class="author flex items-center mb-2">
          <img class="avatar w-[40px] h-[40px] bg-[#ccc] rounded-full mr-[12px]"
              src="{{:authorImage}}"
              alt="{{:authorName}}"
              onerror="this.onerror=null;this.src='https://files.ontraport.com/media/b0456fe87439430680b173369cc54cea.php03bzcx?Expires=4895186056&Signature=fw-mkSjms67rj5eIsiDF9QfHb4EAe29jfz~yn3XT0--8jLdK4OGkxWBZR9YHSh26ZAp5EHj~6g5CUUncgjztHHKU9c9ymvZYfSbPO9JGht~ZJnr2Gwmp6vsvIpYvE1pEywTeoigeyClFm1dHrS7VakQk9uYac4Sw0suU4MpRGYQPFB6w3HUw-eO5TvaOLabtuSlgdyGRie6Ve0R7kzU76uXDvlhhWGMZ7alNCTdS7txSgUOT8oL9pJP832UsasK4~M~Na0ku1oY-8a7GcvvVv6j7yE0V0COB9OP0FbC8z7eSdZ8r7avFK~f9Wl0SEfS6MkPQR2YwWjr55bbJJhZnZA__&Key-Pair-Id=APKAJVAAMVW6XQYWSTNA';">
          <div class="info">
            <span class="name font-bold">{{:authorName}}</span>
            <span class="timestamp text-sm text-[#65676b] ml-2">{{:timeAgo}}</span>
          </div>
        </div>
     <div class="content my-2">{{:content}}</div>
        <div class="file-preview">
          {{if depth === 0}}
            {{if fileContent}}
                {{if fileContent}}
                  {{if fileType === "Image"}}
                    <img src="{{:fileContent}}" style="width:100%;height:300px;object-fit:cover;" alt="preview" />
                  {{else fileType === "Audio"}}
                    <audio class="js-player" controls>
                      <source src="{{:fileContent}}" type="audio/mpeg" />
                      Your browser does not support the audio tag.
                    </audio>
                  {{else fileType === "Video"}}
                    <video class="js-player" controls style="width: 100%; height: auto;">
                      <source src="{{:fileContent}}" type="video/mp4" />
                      Your browser does not support video.
                    </video>
                  {{else}}
                    <a href="{{:fileContent}}" target="_blank" class="line-clamp-1 cursor-pointer text-blue-600 hover:underline">{{:fileContentName}}</a>
                  {{/if}}
                {{/if}}
              {{/if}}
          {{/if}}
          {{if depth > 0}}
          {{if fileContentComment}}
                {{if fileContentComment}}
                  {{if fileType === "Image"}}
                    <img src="{{:fileContentComment || fileContentComment}}" style="width:100%;height:300px;object-fit:cover;" alt="preview" />
                  {{else fileType === "Audio"}}
                    <audio class="js-player" controls>
                      <source src="{{:fileContentComment}}" type="audio/mpeg" />
                      Your browser does not support the audio tag.
                    </audio>
                  {{else fileType === "Video"}}
                    <video class="js-player" controls style="width: 100%; height: auto;">
                      <source src="{{:fileContentComment}}" type="video/mp4" />
                      Your browser does not support video.
                    </video>
                  {{else}}
                    <div>{{:fileContentCommentName}}</div>
                  {{/if}}
                {{/if}}
              {{/if}}
        {{/if}}

  </div>

        <div class="actions">
          <div class = "flex items-center justify-between">
            <div class = "flex items-center gap-4">
              <button class="btn-like{{:hasUpvoted ? ' liked' : ''}} flex items-center" data-uid="{{:uid}}">👍 <span class="ml-1">{{:upvotes}}</span></button>
              <button class="btn-comment flex items-center" data-uid="{{:uid}}">💬</button>
            </div>
            {{if depth === 0}}
              <button class="btn-bookmark{{:hasBookmarked ? ' bookmarked' : ''}} flex items-center" data-uid="{{:uid}}">🔖</button>
            {{/if}}
          </div>
        </div>

        <div class="ribbon w-full my-4 py-2 bg-[#e9ebee] text-center cursor-pointer text-sm hover:bg-[#007bff] hover:text-white" data-uid="{{:uid}}">
          {{if depth === 0}}
            {{:children.length}} {{:children.length === 1 ? 'Comment' : 'Comments'}}
          {{else}}
            {{:children.length}} {{:children.length === 1 ? 'Reply' : 'Replies'}}
          {{/if}}
        </div>
        {{if children.length && !isCollapsed}}
          <div class="children visible my-4 {{:depth < 2 ? 'pl-8 ml-[12px] border-l border-2-[#e9ebee]' : ''}}">
            {{for children}}
              {{include tmpl="#tmpl-item"/}}
            {{/for}}
          </div>
        {{/if}}
      </div>
    </script>


  <script src="https://unpkg.com/mic-recorder-to-mp3@2.2.1/dist/index.min.js"></script>


  <script type="module" src="../src/main.js"></script>

  <div id="toast-container" class="toast-container"></div>

  <div id="file-preview-modal" class="hidden fixed inset-0 bg-black/75 flex items-center justify-center z-[99]">
    <div class="modal-content bg-white p-4 m-4 rounded relative max-w-full max-h-full">

      <div id="preview-container" class="max-h-[80vh] overflow-auto"></div>
    </div>
    <a id="download-preview" href="#" download class="absolute top-2 left-2 cursor-pointer">
      <img
        src="https://files.ontraport.com/media/ff0b848149c5404db647b4457eef571d.phpg4wpao?Expires=4902632030&Signature=Q8vECWWJ6o1mfs-NAwF7pb4NyjHcV2KIOU5TUy8XAiBIb5OHAzHa3t~RU5iqnYH9dIwi7AZoRwJlrl09aLJEmChFz7p~MvbYoTkxDlhWdY2kUtZFasEz3vPQaKGKQG3ghKpUeL3d9JTtT8mmudawUksD-Lp-eLk94jDvTtQPx0e6jb9xkvjnWns2Ux0AdiC60YuKR6J8fUGJfOarN6b8-lthzjjEfliYL~uto9d5ZyrDOi1c7aT0gLbtPRN8ROt3z6hMO0MndWlEtR252zVVEroRBeTymxLmxVzgOFB1bN6gqzUUJznOKuUb75tmybzYpz3B6yUhhF3UkaGa0ZDxVQ__&Key-Pair-Id=APKAJVAAMVW6XQYWSTNA"
        alt="download">
    </a>
    <div id="close-file-preview" class="absolute top-2 cursor-pointer right-2 !p-0">
      <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path
          d="M20 2.5C10.25 2.5 2.5 10.25 2.5 20C2.5 29.75 10.25 37.5 20 37.5C29.75 37.5 37.5 29.75 37.5 20C37.5 10.25 29.75 2.5 20 2.5ZM26.75 28.75L20 22L13.25 28.75L11.25 26.75L18 20L11.25 13.25L13.25 11.25L20 18L26.75 11.25L28.75 13.25L22 20L28.75 26.75L26.75 28.75Z"
          fill="white" />
      </svg>
    </div>
  </div>
</body>

</html>